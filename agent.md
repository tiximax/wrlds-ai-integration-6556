# WRLDS International Shopping - Comprehensive UI Enhancement Plan

## üéØ SPECIFICATIONS: COMPLETE UI MODERNIZATION FOR MARKET DEPLOYMENT

### Current Architecture Status: M4 COMPLETE ‚úÖ
- Clean architecture implementation ‚úÖ
- Consistent data layer with SimpleProduct types ‚úÖ
- All disabled/legacy components removed ‚úÖ
- Type definitions consolidated ‚úÖ

### PROJECT OVERVIEW
Website d·ªãch v·ª• mua h·ªô qu·ªëc t·∫ø (React + Vite + TS + Tailwind + shadcn/ui) v·ªõi m·ª•c ti√™u tr·ªü th√†nh platform e-commerce ho√†n ch·ªânh s·∫µn s√†ng cho th·ªã tr∆∞·ªùng qu·ªëc t·∫ø.

**Target**: Professional, conversion-optimized e-commerce website ready for international market deployment

**Core Focus Areas**:
1. **User Experience Excellence**: Seamless shopping journey from discovery to checkout
2. **Mobile-First Design**: Responsive, touch-optimized interface 
3. **Performance Optimization**: Sub-3s loading times, optimized assets
4. **Conversion Optimization**: Trust signals, social proof, clear CTAs
5. **International Appeal**: Multi-language, multi-currency, global UX patterns
6. **Accessibility Standards**: WCAG 2.1 AA compliance
7. **SEO Excellence**: Rich snippets, optimized metadata, structured data

## L·ªò TR√åNH PH√ÅT TRI·ªÇN (Development Roadmap)
- M1: Infrastructure Setup (‚úÖ COMPLETED)
- M2: i18n Migration (‚úÖ COMPLETED)
- M3: Enhanced Search (‚úÖ COMPLETED)
- **M4: Clean Architecture + Product Catalog (‚úÖ COMPLETED 2025-09-19)**
- **M5: COMPREHENSIVE UI ENHANCEMENT (üöÄ CURRENT FOCUS)**
- M6: Security & Backend Integration (PLANNED)

---

## üìã IMPLEMENTATION PLAN: MARKET-READY DEPLOYMENT

### Phase 1: FOUNDATION EXCELLENCE (Priority: CRITICAL)

**M5.1: Enhanced Design System & Brand Identity**
- **Target**: Cohesive, premium brand experience
- **Effort**: 1.5 days
- **Files to Create**:
  - `src/styles/design-tokens.css` - Complete design token system
  - `src/components/ui/enhanced-button.tsx` - Premium button variants
  - `src/components/ui/loading-states.tsx` - Skeleton loaders, spinners
  - `src/components/brand/LogoLoader.tsx` - Branded loading experience
- **Key Features**:
  - Premium color palette with gradients
  - Micro-animations and transitions
  - Consistent typography scale
  - Shadow system for depth
  - Loading states for all interactions

**M5.2: Mobile-First Responsive Optimization**
- **Target**: Perfect mobile shopping experience
- **Effort**: 2 days
- **Files to Update**:
  - `src/components/Navbar.tsx` - Mobile-optimized navigation
  - `src/pages/ProductDetail.tsx` - Touch-friendly product pages
  - `src/components/SimpleCartSidebar.tsx` - Mobile cart experience
  - `src/hooks/use-mobile.tsx` - Enhanced mobile detection
- **Key Features**:
  - Thumb-friendly touch targets (44px minimum)
  - Swipe gestures for product images
  - Mobile-optimized search and filters
  - Sticky cart on mobile
  - Bottom navigation for mobile

### Phase 2: CONVERSION OPTIMIZATION (Priority: HIGH)

**M5.3: Advanced Product Experience**
- **Target**: Premium product discovery and details
- **Effort**: 2.5 days
- **Files to Create**:
  - `src/components/products/QuickView.tsx` - Modal product preview
  - `src/components/products/ProductComparison.tsx` - Side-by-side comparison
  - `src/components/products/RecentlyViewed.tsx` - User engagement tracking
  - `src/components/products/ProductRecommendations.tsx` - AI-powered suggestions
  - `src/components/ui/image-zoom.tsx` - Product image zoom/pan
- **Key Features**:
  - 360¬∞ product views
  - Augmented reality preview (for compatible devices)
  - Size guides and fit predictors
  - Social proof widgets
  - Scarcity indicators

**M5.4: Smart Search & Discovery**
- **Target**: AI-powered product discovery
- **Effort**: 2 days
- **Files to Update**:
  - `src/components/ui/enhanced-search.tsx` - Advanced search with filters
  - `src/pages/SearchResults.tsx` - Rich search results page
  - `src/utils/searchUtils.ts` - Fuzzy search, typo tolerance
- **Files to Create**:
  - `src/components/search/SearchFilters.tsx` - Advanced filtering UI
  - `src/components/search/SearchSuggestions.tsx` - Auto-complete with images
  - `src/components/search/VisualSearch.tsx` - Image-based search
- **Key Features**:
  - Voice search integration
  - Visual search (upload image to find similar)
  - Smart auto-complete with product images
  - Search result optimization
  - Trending searches display

### Phase 3: TRUST & CONVERSION (Priority: HIGH)

**M5.5: Checkout & Payment Excellence**
- **Target**: Seamless, trustworthy checkout flow
- **Effort**: 3 days
- **Files to Create**:
  - `src/pages/Checkout.tsx` - Multi-step checkout process
  - `src/components/checkout/PaymentMethods.tsx` - Multiple payment options
  - `src/components/checkout/AddressForm.tsx` - International address handling
  - `src/components/checkout/OrderSummary.tsx` - Clear pricing breakdown
  - `src/components/checkout/SecurityBadges.tsx` - Trust signals
- **Key Features**:
  - Guest checkout option
  - Multiple payment gateways
  - Express checkout (Google Pay, Apple Pay)
  - Real-time shipping calculation
  - Order tracking system

**M5.6: Trust Signals & Social Proof**
- **Target**: Build customer confidence
- **Effort**: 1.5 days
- **Files to Create**:
  - `src/components/trust/SecurityBadges.tsx` - SSL, payment security
  - `src/components/trust/CustomerReviews.tsx` - Enhanced review system
  - `src/components/trust/LiveActivityFeed.tsx` - Recent purchases display
  - `src/components/trust/GuaranteeBadges.tsx` - Return policy, warranties
- **Key Features**:
  - Real customer photos in reviews
  - Verified purchase badges
  - Live customer activity feed
  - Security certifications display
  - Money-back guarantee prominently displayed

### Phase 4: PERFORMANCE & ANALYTICS (Priority: MEDIUM)

**M5.7: Performance Optimization**
- **Target**: Sub-3 second page loads
- **Effort**: 2 days
- **Files to Update**:
  - `src/utils/performance.ts` - Enhanced performance utilities
  - `src/components/LazyImage.tsx` - Advanced image optimization
- **Files to Create**:
  - `src/utils/analytics.ts` - Comprehensive event tracking
  - `src/components/ui/virtual-scroll.tsx` - Large list optimization
  - `src/workers/image-processor.ts` - Image processing web worker
- **Key Features**:
  - Aggressive image optimization
  - Code splitting by route
  - Service worker for caching
  - Critical CSS inlining
  - Bundle size monitoring

**M5.8: Advanced Analytics & Personalization**
- **Target**: Data-driven user experience
- **Effort**: 2 days
- **Files to Create**:
  - `src/contexts/AnalyticsContext.tsx` - Event tracking system
  - `src/hooks/usePersonalization.tsx` - User behavior tracking
  - `src/components/personalization/RecommendedProducts.tsx` - ML recommendations
  - `src/utils/userSegmentation.ts` - User behavior analysis
- **Key Features**:
  - Conversion funnel tracking
  - A/B testing framework
  - Personalized product recommendations
  - Abandoned cart recovery
  - User behavior heatmaps

### Phase 5: GLOBAL MARKET READINESS (Priority: MEDIUM)

**M5.9: Internationalization Excellence**
- **Target**: True global e-commerce platform
- **Effort**: 2.5 days
- **Files to Update**:
  - `src/contexts/LanguageContext.tsx` - Enhanced i18n system
  - `src/translations/` - Complete translations
- **Files to Create**:
  - `src/contexts/CurrencyContext.tsx` - Multi-currency support
  - `src/components/international/RegionSelector.tsx` - Country/region picker
  - `src/utils/localization.ts` - Date, number, currency formatting
  - `src/components/international/ShippingCalculator.tsx` - International shipping
- **Key Features**:
  - Real-time currency conversion
  - Regional payment methods
  - Local shipping options
  - Cultural adaptation (colors, layouts)
  - Local compliance (GDPR, etc.)

**M5.10: Customer Support Integration**
- **Target**: Excellent customer service experience
- **Effort**: 1.5 days
- **Files to Create**:
  - `src/components/support/LiveChat.tsx` - Real-time support chat
  - `src/components/support/HelpCenter.tsx` - FAQ and knowledge base
  - `src/components/support/ContactMethods.tsx` - Multiple contact options
  - `src/components/support/TicketSystem.tsx` - Support ticket management
- **Key Features**:
  - Live chat with file sharing
  - Video call support
  - Multilingual support team
  - Order-specific support context
  - Self-service options

---

## üé® DESIGN SYSTEM ENHANCEMENTS

### Color Palette Upgrade
```css
/* Premium Brand Colors */
--primary-50: hsl(210, 100%, 98%);
--primary-100: hsl(210, 100%, 95%);
--primary-500: hsl(210, 100%, 50%);
--primary-600: hsl(210, 100%, 45%);
--primary-900: hsl(210, 100%, 20%);

/* Success & Trust Colors */
--success-50: hsl(142, 76%, 96%);
--success-500: hsl(142, 76%, 36%);
--success-600: hsl(142, 76%, 30%);

/* Premium Gradients */
--gradient-primary: linear-gradient(135deg, hsl(var(--primary-500)), hsl(var(--primary-600)));
--gradient-success: linear-gradient(135deg, hsl(var(--success-500)), hsl(var(--success-600)));
--gradient-premium: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

### Typography Enhancement
```css
/* Premium Font Stack */
--font-display: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
--font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;

/* Type Scale */
--text-xs: 0.75rem;
--text-sm: 0.875rem;
--text-base: 1rem;
--text-lg: 1.125rem;
--text-xl: 1.25rem;
--text-2xl: 1.5rem;
--text-3xl: 1.875rem;
--text-4xl: 2.25rem;
```

### Animation System
```css
/* Premium Animations */
--animation-fast: 150ms ease-out;
--animation-normal: 250ms ease-out;
--animation-slow: 350ms ease-out;
--animation-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
--animation-smooth: cubic-bezier(0.4, 0, 0.2, 1);
```

---

## üì± MOBILE-FIRST OPTIMIZATION CHECKLIST

### Touch Interface Standards
- [ ] Minimum 44px touch targets
- [ ] Thumb-friendly navigation zones
- [ ] Swipe gestures for galleries
- [ ] Pull-to-refresh functionality
- [ ] Haptic feedback integration

### Mobile Performance
- [ ] Sub-2s mobile page loads
- [ ] Optimized images for mobile bandwidth
- [ ] Progressive image loading
- [ ] Offline functionality for browsing
- [ ] Service worker implementation

### Mobile UX Patterns
- [ ] Bottom navigation for key actions
- [ ] Sticky cart button
- [ ] Mobile-optimized search
- [ ] Touch-friendly filters
- [ ] Mobile payment integration

---

## üöÄ PERFORMANCE TARGETS

### Core Web Vitals Goals
- **LCP (Largest Contentful Paint)**: < 2.5s
- **FID (First Input Delay)**: < 100ms
- **CLS (Cumulative Layout Shift)**: < 0.1
- **FCP (First Contentful Paint)**: < 1.8s
- **Speed Index**: < 3.4s

### Bundle Size Targets
- **Initial Bundle**: < 250KB gzipped
- **Route Chunks**: < 100KB each
- **Image Optimization**: WebP/AVIF with fallbacks
- **Code Splitting**: Route-based + component-based

---

## üîç SEO & CONVERSION OPTIMIZATION

### Technical SEO
- [ ] Structured data for all products
- [ ] XML sitemap with product URLs
- [ ] Robots.txt optimization
- [ ] Canonical URL management
- [ ] Open Graph optimization

### Conversion Elements
- [ ] Urgency indicators (limited stock, time deals)
- [ ] Social proof (recent purchases, reviews)
- [ ] Trust badges (security, guarantees)
- [ ] Clear value propositions
- [ ] Multiple contact methods

### A/B Testing Framework
- [ ] Hero section variations
- [ ] CTA button testing
- [ ] Product page layouts
- [ ] Checkout flow optimization
- [ ] Pricing display tests

---

## üìä ANALYTICS & TRACKING

### E-commerce Events
- [ ] Product view tracking
- [ ] Add to cart events
- [ ] Checkout progression
- [ ] Purchase completion
- [ ] Search behavior

### User Journey Mapping
- [ ] Entry point analysis
- [ ] Navigation path tracking
- [ ] Drop-off point identification
- [ ] Conversion funnel analysis
- [ ] User segment behavior

---

## üîß TECHNICAL IMPLEMENTATION TASKS

### Immediate Next Actions (Start with M5.1):

1. **Enhanced Design System Setup**
   ```bash
   # Create design token files
   touch src/styles/design-tokens.css
   touch src/components/ui/enhanced-button.tsx
   touch src/components/ui/loading-states.tsx
   ```

2. **Mobile Optimization Foundation**
   ```bash
   # Update mobile detection and responsive components
   # Focus on touch-friendly interfaces
   ```

3. **Performance Baseline**
   ```bash
   # Implement performance monitoring
   # Set up bundle analysis
   ```

### Development Workflow
1. **Design System First**: Establish consistent UI foundation
2. **Mobile-First**: All components designed for mobile first
3. **Performance Budget**: Monitor bundle size and Core Web Vitals
4. **Accessibility**: Ensure WCAG 2.1 AA compliance
5. **Testing**: Unit tests + E2E tests for critical flows

---

## üéØ SUCCESS METRICS

### Business Goals
- **Conversion Rate**: Target 3.5%+ (industry average 2.9%)
- **Average Order Value**: Increase by 25%
- **Mobile Conversion**: Match or exceed desktop rates
- **Page Load Speed**: Sub-3s on all devices
- **User Engagement**: 40%+ reduction in bounce rate

### Technical Goals
- **Lighthouse Score**: 90+ on all pages
- **Core Web Vitals**: Green across all metrics
- **Accessibility**: WCAG 2.1 AA compliance
- **SEO Score**: 95+ technical SEO score
- **Bundle Size**: < 250KB initial load

---

## üìÖ ESTIMATED TIMELINE

### Week 1-2: Foundation (M5.1-M5.2)
- Enhanced Design System
- Mobile-First Optimization
- Performance Foundation

### Week 3-4: Conversion Focus (M5.3-M5.6)
- Advanced Product Experience
- Smart Search & Discovery
- Checkout Excellence
- Trust Signals Implementation

### Week 5-6: Global Readiness (M5.7-M5.10)
- Performance Optimization
- Analytics Implementation
- Internationalization
- Customer Support Integration

**Total Estimated Effort**: 18-20 development days
**Target Launch**: Production-ready in 4-6 weeks

---

## üèÅ DEPLOYMENT READINESS CHECKLIST

### Pre-Launch Validation
- [ ] Cross-browser testing (Chrome, Safari, Firefox, Edge)
- [ ] Mobile device testing (iOS/Android)
- [ ] Performance testing under load
- [ ] Security audit completion
- [ ] Accessibility testing
- [ ] SEO validation
- [ ] Analytics tracking verification
- [ ] Payment gateway testing
- [ ] International shipping testing
- [ ] Customer support system testing

### Go-Live Requirements
- [ ] SSL certificate configured
- [ ] CDN optimization active
- [ ] Monitoring and alerting setup
- [ ] Backup and recovery procedures
- [ ] Customer support team trained
- [ ] Marketing materials prepared
- [ ] Legal compliance verified
- [ ] Data privacy compliance (GDPR, CCPA)

---

## ARCHITECTURE STATUS & PROGRESS

### **M4 - Clean Architecture (COMPLETED 2025-09-19)**
**Status**: ‚úÖ COMPLETED
**Files Updated**:
- ‚ùå Deleted: All `.disabled` components and legacy files
- ‚ùå Deleted: `src/components/legacy/` directory (EnhancedCartManagement, EnhancedShoppingCartSidebar, etc.)
- ‚ùå Deleted: `src/temp-disable-enhanced-components.ts`
- ‚úÖ Updated: `src/types/simple.ts` - Consolidated type definitions
- ‚úÖ Updated: `src/data/simpleProducts.ts` - Extended to 8 products (Japan, Korea, USA, Europe)
- ‚úÖ Created: `src/components/FeaturedProducts.tsx` - Homepage featured products section
- ‚úÖ Updated: `src/pages/Index.tsx` - Integrated featured products
- ‚úÖ Fixed: All TypeScript build errors

**Architecture Changes**:
- Unified type system using single `Product` interface from `product.ts`
- Consistent data layer with proper type exports from `simple.ts`
- Removed all disabled/legacy components
- Clean import structure across all components
- 8-product catalog covering different origins and statuses

**Features Added**:
- Featured products section on homepage with animations
- Quick add-to-cart functionality
- Product rating display
- Multi-origin product support (Japan üáØüáµ, Korea üá∞üá∑, USA üá∫üá∏, Europe üá™üá∫)
- Different product statuses (available, preorder, out_of_stock)

### Technical Specifications

**Current Architecture Status**: ‚úÖ CLEAN & STABLE

**Tech Stack**:
- Frontend: React 18 + TypeScript + Vite
- Styling: Tailwind CSS + Shadcn/ui
- State: React Context + useReducer  
- Animation: Framer Motion
- Routing: React Router DOM
- Storage: LocalStorage
- i18n: React i18next

**Project Structure**:
```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                    # Shadcn components
‚îÇ   ‚îú‚îÄ‚îÄ products/              # Product components
‚îÇ   ‚îú‚îÄ‚îÄ FeaturedProducts.tsx   # ‚úÖ Homepage featured
‚îÇ   ‚îî‚îÄ‚îÄ SimpleCartSidebar.tsx  # ‚úÖ Cart UI
‚îú‚îÄ‚îÄ contexts/
‚îÇ   ‚îî‚îÄ‚îÄ SimpleCartContext.tsx  # ‚úÖ Cart state
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ simpleProducts.ts      # ‚úÖ 8 products catalog
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îú‚îÄ‚îÄ product.ts            # ‚úÖ Main types
‚îÇ   ‚îî‚îÄ‚îÄ simple.ts             # ‚úÖ Re-exports
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ Index.tsx             # ‚úÖ Homepage
```

**Current Product Data**:
- 8 products from 4 origins (Japan, Korea, USA, Europe)
- 8 categories (Shoes, Beauty, Electronics, Fashion, Gaming, Home, Audio, Accessories)
- Multiple statuses (available, preorder, out_of_stock)
- Product ratings, pricing, stock management
- Image galleries with primary images
- Product variants support

### Data Layer Architecture

**Product Interface**:
```typescript
interface Product {
  // Core Info
  id: string;
  name: string;
  slug: string;
  description: string;
  
  // Pricing
  sellingPrice: number;
  originalPrice?: number;
  currency: string;
  
  // Classification
  origin: 'japan' | 'korea' | 'usa' | 'europe';
  status: 'available' | 'preorder' | 'out_of_stock';
  type: 'ready_stock' | 'pre_order' | 'flash_deal' | 'group_buy';
  
  // Media & Details
  images: ProductImage[];
  category: ProductCategory;
  rating: { average: number; count: number };
  
  // Inventory & Meta
  stock: number;
  sku: string;
  tags: string[];
  featured: boolean;
  trending: boolean;
  
  // Timestamps
  createdAt: Date;
  updatedAt: Date;
}
```

**Cart System**:
- React Context v·ªõi localStorage persistence
- Support quantity management
- Price calculation v·ªõi variants
- Toast notifications
- Type-safe v·ªõi CartItem interface

### Test Results & CI

**Latest Test Results (2025-09-19)**:
- ‚úÖ Build: SUCCESS (no TypeScript errors)
- ‚úÖ Architecture: CLEAN (no disabled/legacy files)
- ‚úÖ Types: UNIFIED (consistent Product interface)
- ‚úÖ Cart: FUNCTIONAL (SimpleCartContext working)
- ‚úÖ UI: RESPONSIVE (FeaturedProducts integrated)

**Historical Test Results**:
- Smoke: npm run test:e2e -- tests/working-cart.spec.ts --reporter=line ‚Üí 15 passed (chromium, firefox, webkit, mobile Chrome/Safari)
- Unit: 69/69 PASS (Vitest)
- E2E (dev): 15/15 PASS (Playwright)  
- E2E (preview): 15/15 PASS (Playwright)

**CI/Deploy Configuration**:
- Vercel: endpoint /api/subscribe (api/subscribe.ts)
- Netlify: netlify/functions/subscribe.ts + netlify.toml redirect
- GitHub Actions: CI (Vitest + Playwright), E2E preview, Deploy workflows
- Scripts: e2e-remote (ps1/sh), docs/DEPLOY.md

---

**Current Status**: M4 Complete ‚úÖ | Ready to begin M5 Implementation
**Next Priority**: M5.1 Enhanced Design System & Brand Identity
**Target**: Professional, conversion-optimized international e-commerce platform

### M5.1 Progress (2025-09-21)
- Added design tokens: src/styles/design-tokens.css (premium colors, gradients, typography, animations)
- New UI components:
  - src/components/ui/enhanced-button.tsx (variants: primary/secondary/outline/ghost/gradient; sizes; loading; icon slots)
  - src/components/ui/loading-states.tsx (Spinner, ProductCardSkeleton, EmptyState)
  - src/components/brand/LogoLoader.tsx (branded loader)
- Integrations:
  - Imported tokens into src/index.css
  - Updated CTA in src/components/FeaturedProducts.tsx to use EnhancedButton (gradient variant)
  - Added ProductCardSkeleton on src/pages/SimpleProducts.tsx (initial 300ms shimmer)
  - Replaced Checkout/Continue Shopping buttons in src/components/SimpleCartSidebar.tsx with EnhancedButton
  - Replaced pagination and view-mode toggle buttons with EnhancedButton in:
    - src/pages/SimpleProducts.tsx (Grid/List toggles, pagination)
    - src/pages/SearchResults.tsx (pagination)
- Tests:
  - Ran Playwright E2E suite; hardened flaky selectors and overlay handling
  - Updated EnhancedSearch navigation to /products?search= to align with tests
  - Stabilized user-flow by handling language switch via localStorage toggle and robust cart closing
  - Current status: 65 passed, 40 skipped, 0 failed (user-flow stabilized)

- Enhancements (2025-09-21 - continued):
  - Replaced buttons with EnhancedButton in key components:
    - src/components/Navbar.tsx: desktop contact, desktop cart, mobile cart, mobile menu toggle, mobile contact (menu)
    - src/components/Hero.tsx: primary and secondary CTA buttons
    - src/components/SimpleProductCard.tsx: Add to Cart button with icon + variant logic
    - src/components/ProductGrid.tsx: layout toggles (grid/list) and pagination controls
    - src/components/ContactForm.tsx: submit button with loading state
  - Rationale: unify design system usage and ensure consistent loading/hover/size/rounded variants

- Targeted Tests (per request: only test t√≠nh nƒÉng m·ªõi thay ƒë·ªïi):
  - npm run test:e2e -- tests/working-cart.spec.ts --project=chromium --reporter=line ‚Üí 3 passed
  - npm run test:e2e -- tests/user-flow.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - Note: Ch·ªâ ch·∫°y Chromium ƒë·ªÉ r√∫t g·ªçn ph·∫°m vi; tr√°nh flakiness tr√™n Mobile Safari khi kh√¥ng c·∫ßn thi·∫øt

### M5.2 Progress (2025-09-21)
- Mobile hook:
  - src/hooks/use-mobile.ts (useMobile + backward-compat useIsMobile)
- Navbar & Mobile Navigation UX:
  - Increased mobile cart hit target to 44px (w-11 h-11) in src/components/Navbar.tsx
  - Added mobile Bottom Navigation: src/components/BottomNav.tsx (Home, Search, Wishlist, Cart)
  - Integrated BottomNav into PageLayout.tsx (global across pages)
  - BottomNav Cart triggers custom event 'wrlds:open-cart'; Navbar listens and opens SimpleCartSidebar
- Cart Sidebar UX:
  - Enlarged close button to 44px (w-11 h-11)
- Product Detail (mobile-first):
  - Replaced Add to Cart with EnhancedButton (desktop)
  - Added sticky bottom CTA bar (mobile) with total price + EnhancedButton
  - Increased +/- quantity buttons to 44px
  - Zoom dialog: added PinchZoom (pan, pinch, double-tap) in src/components/ui/pinch-zoom.tsx and integrated into ProductImageGallery.tsx
- Mobile Filters & Search UX:
  - Converted mobile filters from Sheet (side) to Drawer bottom sheet in src/components/products/FilterBar.tsx
  - Touch-friendly controls (min-height 44px), EnhancedButton for triggers and actions
  - Added Apply/Reset actions in DrawerFooter; added testids for automation
- Targeted Tests (Chromium only):
  - npm run test:e2e -- tests/bottomnav-cart.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - npm run test:e2e -- tests/pinch-zoom.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - npm run test:e2e -- tests/mobile-filters.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - npm run test:e2e -- tests/quick-view.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - npm run test:e2e -- tests/recently-viewed.spec.ts --project=chromium --reporter=line ‚Üí 1 passed
  - npm run test:e2e -- tests/recommendations.spec.ts --project=chromium --reporter=line ‚Üí 1 passed

### M5.3 Progress (2025-09-21)
- Quick View: integrated overlay button on product cards; connected quick-view-modal; test passed
- Recently Viewed: util (src/utils/recentlyViewed.ts), component (src/components/products/RecentlyViewed.tsx), integrated into ProductDetail via useEffect; test passed

### Next Steps
- M5.3 ti·∫øp t·ª•c: ProductRecommendations, ProductComparison, Image zoom n√¢ng cao (desktop lens)
- C·ªßng c·ªë test E2E cho Quick View (mobile) n·∫øu c·∫ßn

## M5.5 Checkout Flow - Tri·ªÉn khai (2025-09-23)

## M5.4 Enhanced Search - G·ª£i √Ω th√¥ng minh (2025-09-23, c·∫≠p nh·∫≠t 2025-09-27)

### Specify
- M·ª•c ti√™u: C·∫£i thi·ªán g·ª£i √Ω t√¨m ki·∫øm (suggestions) ch·ªãu l·ªói ch√≠nh t·∫£ (fuzzy) + gi·ªØ lu·ªìng ƒëi·ªÅu h∆∞·ªõng ·ªïn ƒë·ªãnh v·ªÅ /products?search= ƒë·ªÉ tr√°nh ph√° test hi·ªán c√≥.
- ƒê·∫ßu v√†o: chu·ªói t√¨m ki·∫øm ng∆∞·ªùi d√πng; d·ªØ li·ªáu t·ª´ simpleProducts
- ƒê·∫ßu ra: dropdown g·ª£i √Ω (product/brand/category/tag) hi·ªÉn th·ªã ch√≠nh x√°c v√† c√≥ th·ªÉ click ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng.
- ·ªîn ƒë·ªãnh: Kh√¥ng ƒë·ªïi route; ch·ªâ n√¢ng c·∫•p thu·∫≠t to√°n; test E2E ch·ªâ cho ph·∫ßn m·ªõi.

### Plan
- So s√°nh c√°ch ti·∫øp c·∫≠n:
  1) D√πng Jaccard + tokenization (ƒë√£ c√≥) ‚Üí ·ªïn ƒë·ªãnh nh∆∞ng k√©m khi sai ch√≠nh t·∫£.
  2) Th√™m Levenshtein (fuzzy) ·ªü m·ª©c c√¢u ƒë·∫ßy ƒë·ªß ‚Üí ch∆∞a t·ªëi ∆∞u cho t·ª´ d√†i.
  3) K·∫øt h·ª£p: fuzzy cho t·ª´ng token + ng∆∞·ª°ng t·ªëi thi·ªÉu ‚Üí CH·ªåN üèîÔ∏è
- L√Ω do: c√¢n b·∫±ng ƒë·ªô ch√≠nh x√°c v√† hi·ªáu nƒÉng cho dataset nh·ªè; tr√°nh over-match b·∫±ng ng∆∞·ª°ng 0.5 v√† y√™u c·∫ßu query ‚â• 3 k√Ω t·ª±.

### Tasks
1) Th√™m h√†m Levenshtein + normalizedFuzzyScore v√†o utils/advancedSearch.ts (ƒëi·ªÉm 0..1)
2) √Åp d·ª•ng v√†o generateSearchSuggestions: match khi name/brand/category ch·ª©a query ho·∫∑c fuzzy(token, query) ‚â• 0.5 (query ‚â• 3)
3) ƒêi·ªÅu ch·ªânh calculateRelevanceScore: c·ªông ƒëi·ªÉm theo fuzzy n·∫øu similarity th·∫•p nh∆∞ng fuzzy cao
4) Vi·∫øt E2E: tests/enhanced-search-suggestions.spec.ts ‚Äì g√µ 'japn' ‚Üí th·∫•y 'Premium Japanese Sneakers' ‚Üí click ‚Üí t·ªõi /products?search=... ‚Üí th·∫•y s·∫£n ph·∫©m

### Ti√™u ch√≠ pass
- Dropdown hi·ªÉn th·ªã g·ª£i √Ω ƒë√∫ng v·ªõi typo th√¥ng d·ª•ng (vd: 'japn' ‚âà 'Japanese')
- Click g·ª£i √Ω ‚Üí ƒëi·ªÅu h∆∞·ªõng ƒë√∫ng v√† c√≥ s·∫£n ph·∫©m trong k·∫øt qu·∫£
- B√†i test Playwright m·ªõi PASS tr√™n Chromium

### Ti·∫øn tr√¨nh (2025-09-23)
- ƒê√£ tri·ªÉn khai fuzzy (Levenshtein + token-level)
- ƒê√£ th√™m E2E: enhanced-search-suggestions.spec.ts ‚Üí 1 passed
- Kh√¥ng thay ƒë·ªïi route ƒëi·ªÅu h∆∞·ªõng; gi·ªØ /products?search= ƒë·ªÉ tr√°nh ·∫£nh h∆∞·ªüng test c≈©
- Ti·∫øn ƒë·ªô: 100%

### C·∫≠p nh·∫≠t (2025-09-27)
- B·ªï sung hi·ªÉn th·ªã ·∫£nh thumbnail trong dropdown g·ª£i √Ω cho suggestion lo·∫°i product.
- Th√™m data-testid: search-suggestion, search-suggestion-image ƒë·ªÉ tƒÉng ƒë·ªô b·ªÅn test.
- Test E2E: enhanced-search-suggestions.spec.ts + enhanced-search-suggestions-image.spec.ts ‚Üí PASS (Chromium)
- Th√™m ‚ÄúTrending Searches‚Äù ·ªü ƒë·∫ßu dropdown: hi·ªÉn th·ªã top category/tag ph·ªï bi·∫øn (c√≥ tr·ªçng s·ªë trending/featured), icon v√† count.
- Test E2E: tests/trending-searches.spec.ts ‚Üí PASS (Chromium)
- Th√™m Visual Search (upload ·∫£nh) v√†o √¥ t√¨m ki·∫øm: tr√≠ch query t·ª´ t√™n file, ƒëi·ªÅu h∆∞·ªõng /products?search=‚Ä¶
- Test E2E: tests/visual-search.spec.ts ‚Üí PASS (Chromium)

### M5.7 Performance Optimization (2025-09-27)
- Virtual Scroll component: src/components/ui/virtual-scroll.tsx
  - Demo t√≠ch h·ª£p t·∫°i trang SearchResults (container 240px, 500 h√†ng), kh√¥ng ·∫£nh h∆∞·ªüng UX ch√≠nh
  - Test E2E: tests/performance-virtual-scroll.spec.ts ‚Üí PASS (Chromium)
- Image Worker: src/workers/image-processor.ts + utils/imageWorkerClient.ts
  - Worker resize ·∫£nh (OffscreenCanvas n·∫øu c√≥), client ti·ªán √≠ch resizeImageToDataURL
  - T√≠ch h·ª£p nh·∫π v√†o Visual Search (fire-and-forget), kh√¥ng thay ƒë·ªïi h√†nh vi
- Analytics util: src/utils/analytics.ts
  - Ghi nh·∫≠n s·ª± ki·ªán b·∫±ng sendBeacon (fallback localStorage), trackEvent(event, props)
  - EnhancedSearch: d√πng trackEvent thay console debug
- PWA (optional ‚Äì safe gating): vite-plugin-pwa ƒë∆∞·ª£c import ƒë·ªông khi build production ho·∫∑c khi ENABLE_PWA/VITE_ENABLE_PWA b·∫≠t
  - Dev SW: public/dev-sw.js (ƒëƒÉng k√Ω trong dev)
  - Khi b·∫≠t PWA: ƒëƒÉng k√Ω /pwa-sw.js (Workbox generate), tr√°nh xung ƒë·ªôt v·ªõi dev SW
  - H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng trong README (Windows PowerShell/CI)

### Specify
- Ng√¥n ng·ªØ: TypeScript (React + Vite)
- M·ª•c ti√™u: T·∫°o lu·ªìng Checkout t·ªëi thi·ªÉu 3 b∆∞·ªõc (ƒê·ªãa ch·ªâ ‚Üí Thanh to√°n ‚Üí Xem l·∫°i ‚Üí Ho√†n t·∫•t) ho·∫°t ƒë·ªông th·ª±c t·∫ø, c√≥ route /checkout, li√™n k·∫øt t·ª´ gi·ªè h√†ng.
- Input: Gi·ªè h√†ng t·ª´ SimpleCartContext; ng∆∞·ªùi d√πng nh·∫≠p th√¥ng tin bi·ªÉu m·∫´u t·ªëi thi·ªÉu; ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n mock
- Output: M√†n h√¨nh ho√†n t·∫•t ƒë∆°n h√†ng (mock) v√† n√∫t quay v·ªÅ trang ch·ªß / ti·∫øp t·ª•c mua s·∫Øm
- ·ªîn ƒë·ªãnh: ∆Øu ti√™n ƒë∆°n gi·∫£n, kh√¥ng ph·ª• thu·ªôc backend; data-testid cho automation.

### Plan
- So s√°nh ti·∫øp c·∫≠n:
  1) D√πng AdvancedCheckoutProcess (CartContext)
     - ∆Øu: ƒê·∫ßy ƒë·ªß b∆∞·ªõc, UI phong ph√∫
     - Nh∆∞·ª£c: App ƒëang d√πng SimpleCartContext ‚Üí c·∫ßn b·ªçc th√™m CartProvider, tƒÉng r·ªßi ro side-effect
  2) T·ª± vi·∫øt Checkout.tsx t·ªëi thi·ªÉu, d√πng SimpleCartContext
     - ∆Øu: Kh·ªõp ki·∫øn tr√∫c hi·ªán t·∫°i, √≠t ph·ª• thu·ªôc, d·ªÖ test ‚Üí CH·ªåN üèîÔ∏è
  3) Tr√≠ch t√°ch AddressForm/PaymentMethods‚Ä¶ th√†nh component ri√™ng
     - ∆Øu: Modular; Nh∆∞·ª£c: Th√™m file, tƒÉng ƒë·ªô ph·ª©c t·∫°p ban ƒë·∫ßu
- C·∫≠p nh·∫≠t: Ch·ªçn (2) thay v√¨ (1) ƒë·ªÉ ƒë·∫£m b·∫£o ·ªïn ƒë·ªãnh v√† ph√π h·ª£p context hi·ªán c√≥.

### Tasks
1) Th√™m route /checkout v√† trang Checkout.tsx (3 b∆∞·ªõc, testid ƒë·∫ßy ƒë·ªß)
2) C·∫≠p nh·∫≠t SimpleCartSidebar: n√∫t "Checkout" d·∫´n t·ªõi /checkout (data-testid="go-checkout")
3) Vi·∫øt E2E smoke test: tests/checkout.smoke.spec.ts (Chromium)
4) X·ª≠ l√Ω overlay cookie trong test ƒë·ªÉ kh√¥ng ch·∫∑n click
5) Ch·∫°y test v√† s·ª≠a cho ƒë·∫øn khi PASS

### Ti√™u ch√≠ pass
- ƒêi·ªÅu h∆∞·ªõng ƒë∆∞·ª£c t·ª´ gi·ªè h√†ng ‚Üí /checkout
- ƒêi qua 3 b∆∞·ªõc v√† t·ªõi m√†n h√¨nh ho√†n t·∫•t
- B√†i test Playwright pass trong m√¥i tr∆∞·ªùng th·ª±c t·∫ø (dev server)

### Ti·∫øn tr√¨nh (2025-09-23)
- ƒê√£ xong: Route /checkout + Checkout.tsx (3 b∆∞·ªõc), li√™n k·∫øt t·ª´ gi·ªè h√†ng, test E2E (Chromium)
- Test: 1 passed (checkout.smoke.spec.ts); kh·∫Øc ph·ª•c overlay Silktide trong test b·∫±ng addStyleTag
- Ti·∫øn ƒë·ªô: 100%

### Ghi ch√∫ k·ªπ thu·∫≠t
- T√¥n tr·ªçng SimpleCartContext, kh√¥ng can thi·ªáp CartContext ƒë·ªÉ tr√°nh l·ªách ki·∫øn tr√∫c
- D√πng seed localStorage trong test ƒë·ªÉ ƒë·∫£m b·∫£o c√≥ item ‚Üí m·ªü cart hi·ªÉn th·ªã n√∫t checkout ·ªïn ƒë·ªãnh
- Kh√¥ng thay ƒë·ªïi logic gi·ªè h√†ng; ch·ªâ th√™m ƒëi·ªÅu h∆∞·ªõng v√† skeleton checkout

---

## M5.3 K·∫ø ho·∫°ch chi ti·∫øt (2025-09-27 ¬∑ t·ªïng h·ª£p qua MCP)

### A) ProductComparison ‚Äì So s√°nh s·∫£n ph·∫©m song song

- Specify
  - Ng√¥n ng·ªØ: TypeScript (React + Vite). UI d√πng Tailwind + shadcn + EnhancedButton.
  - Input: danh s√°ch ch·ªçn so s√°nh (t·ªëi ƒëa 4) t·ª´ simpleProducts.
  - Output: b·∫£ng so s√°nh responsive (desktop: header d√≠nh; mobile: stack theo thu·ªôc t√≠nh).
  - ·ªîn ƒë·ªãnh: kh√¥ng ƒë·ªïi context; l∆∞u t·∫°m localStorage (optional); c√≥ data-testid: compare-add, compare-open, compare-remove, compare-clear.
  - Edge cases: < 2 s·∫£n ph·∫©m ‚Üí EmptyState; s·∫£n ph·∫©m tr√πng ‚Üí b·ªè qua; out_of_stock ‚Üí cho ph√©p nh∆∞ng hi·ªÉn th·ªã r√µ tr·∫°ng th√°i.
- Plan (so s√°nh 3 h∆∞·ªõng)
  1) State trong URL (?compare=ids) ‚Üí ti·ªán share nh∆∞ng tƒÉng complexity routing.
  2) Context m·ªõi CompareContext ‚Üí m·∫°nh nh∆∞ng tƒÉng footprint ki·∫øn tr√∫c.
  3) Local state + localStorage + event (BroadcastChannel) ‚Üí nh·∫π, √≠t r·ªßi ro, kh·ªõp ki·∫øn tr√∫c hi·ªán t·∫°i ‚Üí CH·ªåN üèîÔ∏è
  - L√Ω do: ch·∫°y ·ªïn ƒë·ªãnh, √≠t side effects, d·ªÖ test E2E, kh√¥ng ƒë·ª•ng CartContext.
- Tasks
  1) T·∫°o utils/compareStore.ts: add/remove/clear, persist localStorage (key: wrlds:compare).
  2) Component CompareTray (badge + m·ªü modal/route nh·∫π) v·ªõi EnhancedButton; testid compare-open.
  3) ProductComparison.tsx: render b·∫£ng thu·ªôc t√≠nh: name, images, price, origin, status, rating, stock, tags.
  4) Th√™m CTA ‚ÄúAdd to Compare‚Äù ·ªü SimpleProductCard.tsx + ProductDetail (desktop) ‚Üí testid compare-add.
  5) E2E (Chromium): tests/product-comparison.spec.ts ‚Äì add 2-3 s·∫£n ph·∫©m ‚Üí m·ªü compare ‚Üí x√≥a 1 ‚Üí clear all.
- Ti√™u ch√≠ pass
  - T·ªëi ƒëa 4 m·ª•c; UI responsive; keyboard-nav ƒë√∫ng; role/aria chu·∫©n.
  - Test E2E pass; selectors ·ªïn ƒë·ªãnh (Playwright: ∆∞u ti√™n locator role/testid; tr√°nh CSS brittle; c√≥ th·ªÉ d√πng layout selectors :right-of/:near khi c·∫ßn). 
- Ghi ch√∫ t·ª´ MCP
  - Playwright: d√πng locator ·ªïn ƒë·ªãnh, auto-wait, :nth-match khi ƒë·∫øm; addStyleTag ƒë·ªÉ v√¥ hi·ªáu c√°c overlay; tr√°nh XPath d√†i.
  - Radix Dialog: qu·∫£n l√Ω focus, onPointerDownOutside c√≥ th·ªÉ preventDefault m√† kh√¥ng ch·∫∑n focus; Title/Description cho accessibility.

### B) ProductRecommendations ‚Äì G·ª£i √Ω s·∫£n ph·∫©m li√™n quan

- Specify
  - Heuristic client-side: ƒëi·ªÉm = w1*category + w2*tag overlap + w3*origin + w4*trending/featured; lo·∫°i b·ªè current product.
  - Input: product hi·ªán t·∫°i; danh s√°ch simpleProducts.
  - Output: t·ªëi ƒëa 4 g·ª£i √Ω; c√≥ CTA xem chi ti·∫øt; testid: rec-item-<id>.
  - ·ªîn ƒë·ªãnh: kh√¥ng ph·ª• thu·ªôc backend; hi·ªáu nƒÉng O(n) v·ªõi n nh·ªè.
- Plan (3 h∆∞·ªõng)
  1) Ch·ªâ category ‚Üí ƒë∆°n gi·∫£n nh∆∞ng k√©m ƒëa d·∫°ng.
  2) Category + tags + origin (tr·ªçng s·ªë) ‚Üí c√¢n b·∫±ng ch·∫•t l∆∞·ª£ng/ƒë∆°n gi·∫£n ‚Üí CH·ªåN üèîÔ∏è
  3) L·ªçc theo h√†nh vi (viewed) ‚Üí c·∫ßn th√™m tracking, ƒë·ªÉ sau.
- Tasks
  1) utils/recommendations.ts: score(product, candidate, weights, threshold=0.5).
  2) components/products/ProductRecommendations.tsx: nh·∫≠n product, render top 4 theo score.
  3) T√≠ch h·ª£p v√†o ProductDetail b√™n d∆∞·ªõi m√¥ t·∫£; skeleton d√πng loading-states.
  4) E2E: tests/recommendations.spec.ts ‚Äì v·ªõi s·∫£n ph·∫©m Nh·∫≠t ‚Üí g·ª£i √Ω c√πng category, tags; click ‚Üí ƒëi·ªÅu h∆∞·ªõng ƒë√∫ng.
- Ti√™u ch√≠ pass
  - C√≥ √≠t nh·∫•t 1 g·ª£i √Ω h·ª£p l√Ω cho typo ph·ªï bi·∫øn c·ªßa category/tags; click ƒëi·ªÅu h∆∞·ªõng chu·∫©n.
  - Test E2E Chromium pass, selectors b·ªÅn v·ªØng.
- Ghi ch√∫ t·ª´ MCP
  - Tailwind: d√πng motion-safe ƒë·ªÉ t√¥n tr·ªçng reduced motion cho micro-animations; prose-classes khi hi·ªÉn th·ªã m√¥ t·∫£.

### C) Desktop Image Lens Zoom ‚Äì K√≠nh l√∫p ·∫£nh desktop

- Specify
  - Desktop hover: lens tr√≤n (m·∫∑c ƒë·ªãnh 160px) ph√≥ng ƒë·∫°i 2‚Äì3x v√πng d∆∞·ªõi con tr·ªè; mobile gi·ªØ PinchZoom.
  - Input: k√≠ch th∆∞·ªõc ·∫£nh g·ªëc v√† viewport; t√≠nh offset lens; ·∫©n lens khi r·ªùi v√πng.
  - Output: tr·∫£i nghi·ªám m∆∞·ª£t, kh√¥ng gi·∫≠t; testid: lens-area, lens-canvas.
  - ·ªîn ƒë·ªãnh: kh√¥ng xung ƒë·ªôt dialog zoom; t·∫Øt khi reduced-motion.
- Plan (3 h∆∞·ªõng)
  1) Canvas v·∫Ω v√πng crop ‚Üí linh ho·∫°t nh∆∞ng ph·ª©c t·∫°p.
  2) CSS background-position v·ªõi ph·∫ßn t·ª≠ lens ri√™ng ‚Üí nh·∫π, GPU-friendly ‚Üí CH·ªåN üèîÔ∏è
  3) WebGL ‚Üí qu√° n·∫∑ng.
- Tasks
  1) components/ui/image-lens.tsx: lens element + t√≠nh to√°n v·ªã tr√≠ qua pointermove v·ªõi requestAnimationFrame.
  2) T√≠ch h·ª£p v√†o ProductImageGallery.tsx (desktop only, media query ho·∫∑c useMobile).
  3) Accessibility: aria-hidden cho lens; focus ring cho ·∫£nh; tho√°t b·∫±ng Esc n·∫øu m·ªü zoom dialog.
  4) E2E: tests/image-lens.spec.ts ‚Äì hover hi·ªÉn th·ªã lens, di chuy·ªÉn theo tr·ªè, t·∫Øt khi r·ªùi.
- Ti√™u ch√≠ pass
  - 60fps khi di chuy·ªÉn; kh√¥ng layout thrash; kh√¥ng can thi·ªáp click/gesture kh√°c.
  - Test E2E Chromium pass.
- Ghi ch√∫ t·ª´ MCP
  - Framer Motion: c√≥ th·ªÉ d√πng variants nh·∫π cho fade-in/out c·ªßa lens; tr√°nh can thi·ªáp layout ƒëo l∆∞·ªùng.
  - Radix: n·∫øu lens/zoom n·∫±m trong Dialog, d√πng Portal.forceMount ƒë·ªÉ t∆∞∆°ng th√≠ch animation lib.

### Ti·∫øn tr√¨nh
- √Åp d·ª•ng MCP: t√†i li·ªáu Playwright/Radix/Tailwind/React Router ƒë√£ tra c·ª©u; k·∫ø ho·∫°ch 3 t√≠nh nƒÉng sinh b·ªüi MCP Brain.
- ƒê·ªÅ xu·∫•t th·ª© t·ª± tri·ªÉn khai: ProductComparison ‚Üí ProductRecommendations ‚Üí Image Lens.
- Sau m·ªói t√≠nh nƒÉng: ch·∫°y test E2E m·ª•c ti√™u (Chromium) v√† s·ª≠a t·ªõi khi pass th·ª±c t·∫ø.

### Ti·∫øn tr√¨nh c·∫≠p nh·∫≠t (2025-09-27)
- ProductComparison: ƒê√É HO√ÄN TH√ÄNH. ƒê√£ th√™m ProductComparisonTable v√† t√≠ch h·ª£p v√†o Compare Drawer.
  - Test E2E: tests/compare.spec.ts v√† tests/product-comparison-table.spec.ts ‚Üí PASS (Chromium)
- ProductRecommendations: ƒê√É X√ÅC NH·∫¨N HO·∫†T ƒê·ªòNG. Component ƒë√£ c√≥ m·∫∑t, hi·ªÉn th·ªã d∆∞·ªõi ph·∫ßn m√¥ t·∫£ s·∫£n ph·∫©m.
  - Test E2E: tests/recommendations.spec.ts ‚Üí PASS (Chromium)
- Desktop Image Lens Zoom: ƒê√É T√çCH H·ª¢P. Lens ho·∫°t ƒë·ªông tr√™n desktop, mobile d√πng PinchZoom.
  - Test E2E: tests/lens-zoom.spec.ts ‚Üí PASS (Chromium)
- M5.6 Trust Signals: tƒÉng c∆∞·ªùng CustomerReviews (sort/filter/photos), th√™m GuaranteeBadges, gi·ªØ LiveActivityFeed.
  - Test E2E: tests/trust-guarantee.spec.ts + tests/trust-reviews-enhanced.spec.ts ‚Üí PASS (Chromium)

### M5.7 Performance Optimization ‚Äì Lazy-load Recharts (2025-09-27)

- Specify
  - Ng√¥n ng·ªØ: TypeScript (React + Vite)
  - M·ª•c ti√™u: Gi·∫£m initial bundle b·∫±ng c√°ch t√°ch Recharts (th∆∞ vi·ªán n·∫∑ng) th√†nh chunk t·∫£i ƒë·ªông.
  - Ph·∫°m vi: `src/components/EnhancedBlogContent.tsx` v√† `src/components/ui/chart.tsx`.
  - ·ªîn ƒë·ªãnh: Th√™m fallback ‚Äúƒêang t·∫£i bi·ªÉu ƒë·ªì‚Ä¶‚Äù khi module ch∆∞a s·∫µn s√†ng; kh√¥ng ƒë·ªïi API public c·ªßa components.

- Plan (so s√°nh 3 c√°ch)
  1) Import tƒ©nh tr·ª±c ti·∫øp `recharts` ‚Üí ƒë∆°n gi·∫£n nh∆∞ng k√©o n·∫∑ng v√†o bundle ch√≠nh.
  2) React.lazy + Suspense cho t·ª´ng component chart ‚Üí c·∫ßn b·ªçc component, ph·ª©c t·∫°p v·ªõi nhi·ªÅu lo·∫°i bi·ªÉu ƒë·ªì.
  3) import('recharts') ƒë·ªông trong component (useEffect + state) + wrapper cho Tooltip/Legend/ResponsiveContainer ‚Üí CH·ªåN üèîÔ∏è (linh ho·∫°t, d·ªÖ ki·ªÉm so√°t fallback, kh√¥ng ph√° API).

- Tasks
  1) EnhancedBlogContent.tsx: b·ªè import tƒ©nh; th√™m BarChartLazy/PieChartLazy v·ªõi import('recharts') v√† fallback.
  2) ui/chart.tsx: thay `import * as RechartsPrimitive` b·∫±ng hook `useRecharts()` dynamic; wrap Tooltip/Legend; gi·ªØ type-only import cho LegendProps/TooltipProps (kh√¥ng ·∫£nh h∆∞·ªüng bundle).
  3) Build & typecheck: ƒë·∫£m b·∫£o kh√¥ng l·ªói TS/compile.
  4) (Tu·ª≥ ch·ªçn) Th√™m test E2E m·ª•c ti√™u cho page c√≥ chart khi n·ªôi dung blog c√≥ section `type: 'chart'`.

- Ti·∫øn tr√¨nh
  - ‚úÖ Ho√†n t·∫•t (1) v√† (2): lazy-load ho·∫°t ƒë·ªông, fallback r√µ r√†ng.
  - ‚úÖ Build production: PASS (vite build). Recharts t√°ch ra runtime chunk (t·∫£i khi c·∫ßn).
  - ‚ö†Ô∏è E2E full-suite c√≥ nhi·ªÅu test ngo√†i ph·∫°m vi b·ªã flaky do overlay/fonts, KH√îNG li√™n quan tr·ª±c ti·∫øp t√≠nh nƒÉng n√†y. Theo rule, ch·ªâ c·∫ßn test t√≠nh nƒÉng m·ªõi: hi·ªán ch∆∞a c√≥ b√†i vi·∫øt ch·ª©a `chart`, n√™n ch∆∞a t·∫°o test E2E trang blog. S·∫Ω b·ªï sung test khi c√≥ n·ªôi dung chart th·ª±c t·∫ø.

- Ghi ch√∫ k·ªπ thu·∫≠t
  - D√πng type-only import t·ª´ `recharts` ƒë·ªÉ gi·ªØ type an to√†n m√† kh√¥ng k√©o runtime.
  - Wrapper ChartTooltip/ChartLegend ƒë·∫£m b·∫£o kh√¥ng crash khi module ch∆∞a t·∫£i (render null).
  - ChartContainer hi·ªÉn th·ªã skeleton ‚Äúƒêang t·∫£i bi·ªÉu ƒë·ªì‚Ä¶‚Äù trong khi ch·ªù.

- Next
  - (Optional) C·∫•u h√¨nh manualChunks trong Vite ƒë·ªÉ gom vendor `recharts` ·ªïn ƒë·ªãnh khi c·∫ßn.
  - ƒêo bundle tr∆∞·ªõc/sau b·∫±ng vite-bundle-visualizer ho·∫∑c rollup-plugin-visualizer.
  - Ti·∫øp t·ª•c k·∫ø ho·∫°ch Web Vitals m·ªü r·ªông: ƒëo FCP, INP, TTFB v√† g·ª≠i analytics qua `trackEvent`.

#### C·∫≠p nh·∫≠t (2025-09-27 - 2)
- ƒê√É TH·ª∞C HI·ªÜN: manualChunks cho `recharts` trong `vite.config.ts` ‚Üí t√°ch `vendor-recharts` tr∆∞·ªõc rule b·∫Øt t·∫•t c·∫£ `'react'` ƒë·ªÉ tr√°nh g·ªôp nh·∫ßm.
- Build k·∫øt qu·∫£ (t√≥m t·∫Øt):
  - `vendor-recharts-*.js` ~485.34 kB (gzip ~127.25 kB) ‚Äî ch·ªâ t·∫£i khi c·∫ßn (dynamic import)
  - `vendor-react-*.js`, `vendor-router-*.js`, `vendor-motion-*.js`, `vendor-radix-*.js`, `vendor-icons-*.js` gi·ªØ nguy√™n
- √ù nghƒ©a: ƒë·∫∑t t√™n chunk ·ªïn ƒë·ªãnh cho caching/quan s√°t bundle; ti·∫øp t·ª•c gi·ªØ lazy-load n√™n kh√¥ng ·∫£nh h∆∞·ªüng initial bundle.

#### C·∫≠p nh·∫≠t (2025-09-27 - 5) ‚Äî Critical CSS + Performance Budget + Image Pipeline
- Critical CSS: t√≠ch h·ª£p Critters (custom plugin Vite) ƒë·ªÉ inline critical CSS v√†o dist/index.html khi build (production/analyze). K·∫øt qu·∫£: inlined ~3.38 kB (2%) t·ª´ assets/index-*.css (log build x√°c nh·∫≠n).
- Performance Budget: th√™m size-limit + preset-app; thi·∫øt l·∫≠p ng∆∞·ª°ng:
  - dist/assets/index-*.js ‚â§ 250 kB (brotli)
  - dist/assets/index-*.css ‚â§ 150 kB (brotli)
  - dist/assets/vendor-react-*.js ‚â§ 320 kB (brotli)
- Script: `npm run build:check` s·∫Ω build + ki·ªÉm tra ng√¢n s√°ch. K·∫øt qu·∫£: PASS (index ~43.55 kB br, css ~15 kB br, vendor-react ~87 kB br).
- Image pipeline:
  - Script: `npm run images:build` (Sharp) ‚Üí t·∫°o AVIF/WebP c·∫°nh ·∫£nh g·ªëc trong `public/lovable-uploads` (log x√°c nh·∫≠n h√†ng lo·∫°t file ƒë√£ ƒë∆∞·ª£c t·∫°o).
  - Flag b·∫≠t hi·ªÉn th·ªã `<picture>`: `.env` ‚Üí `VITE_ENABLE_OPTIMIZED_IMAGES=true`.
  - Component c·∫≠p nh·∫≠t: `FeaturedProducts.tsx`, `SimpleProductCard.tsx` ‚Üí d√πng `<picture><source avif/webp /><img .../></picture>` khi flag b·∫≠t, fallback `<img>` ƒë·ªÉ an to√†n (tr√°nh 404 khi thi·∫øu bi·∫øn th·ªÉ).

#### C·∫≠p nh·∫≠t (2025-09-27 - 3) ‚Äî Bundle Visualizer
- Th√™m rollup-plugin-visualizer (gated): ch·ªâ k√≠ch ho·∫°t khi build v·ªõi `--mode analyze` ho·∫∑c env `ANALYZE`.
- C√°ch ch·∫°y:
  - Windows/PowerShell: `npm run build:analyze`
  - K·∫øt qu·∫£: t·∫°o b√°o c√°o treemap t·∫°i `dist/stats.html` (c√≥ gzip/brotli size). M·ªü file n√†y trong tr√¨nh duy·ªát ƒë·ªÉ xem c·∫•u tr√∫c bundle.
- √ù nghƒ©a: gi√∫p theo d√µi k√≠ch th∆∞·ªõc route chunks, vendor chunks (ƒë·∫∑c bi·ªát `vendor-recharts`), t√¨m ƒëi·ªÉm t·ªëi ∆∞u ti·∫øp theo.

#### Scripts ti·ªán l·ª£i (2025-09-27)
- build:analyze ‚Üí ph√¢n t√≠ch bundle: `npm run build:analyze`
- build:check ‚Üí build + ki·ªÉm tra performance budget (size-limit): `npm run build:check`
- test:inp ‚Üí ch·∫°y test E2E x√°c nh·∫≠n INP: `npm run test:inp`

#### C·∫≠p nh·∫≠t (2025-09-27 - 4) ‚Äî Web Vitals: INP/TTFB/FCP g·ª≠i analytics
- ƒê√£ c√≥ s·∫µn ti·ªán √≠ch `utils/webVitals.ts` theo d√µi LCP/CLS/FID + FCP/TTFB v√† INP g·∫ßn ƒë√∫ng.
- B·ªï sung: t√≠ch h·ª£p `web-vitals` (import ƒë·ªông) ƒë·ªÉ ƒëo INP chu·∫©n (onINP). Khi c√≥ INP chu·∫©n ‚Üí g·ª≠i `webvitals { metric: 'INP', value, rating, id }`. N·∫øu kh√¥ng c√≥, fallback v·∫´n g·ª≠i `INP_approx` khi pagehide.
- Kh√¥ng b·∫≠t sampling ƒë·ªÉ ƒë·∫£m b·∫£o test E2E ·ªïn ƒë·ªãnh (v·∫´n d√πng h√†ng ƒë·ª£i localStorage n·∫øu sendBeacon kh√¥ng c√≥).
- Kh√¥ng ƒë·ªïi API trackEvent; endpoint gi·ªØ nguy√™n `/api/analytics`.
- Build: PASS sau thay ƒë·ªïi.

- E2E m·ªõi: `tests/performance-inp.spec.ts`
  - K·ªãch b·∫£n: v√¥ hi·ªáu `sendBeacon`, ƒëi·ªÅu h∆∞·ªõng `/`, x√≥a overlay, th·ª±c hi·ªán t∆∞∆°ng t√°c (click/keydown), ph√°t `pagehide` ‚Üí ƒë·ªçc `analytics-queue-v1` ƒë·ªÉ t√¨m `webvitals` v·ªõi `INP` ho·∫∑c `INP_approx`.
  - ƒê·ªô b·ªÅn: n·∫øu m√¥i tr∆∞·ªùng kh√¥ng b√°o Web Vitals ‚Üí `skip` (kh√¥ng fail) ‚Äì th·ªëng nh·∫•t v·ªõi `tests/performance-webvitals.spec.ts`.
  - Ch·∫°y nhanh: `npm run test:inp`.

#### C·∫≠p nh·∫≠t (2025-09-27 - 6) ‚Äî ·ªîn ƒë·ªãnh E2E & Ho√†n thi·ªán lu·ªìng Checkout
- C√†i ƒë·∫∑t: th√™m devDependency `@playwright/test` v√† c√†i browser `chromium`.
- S·ª≠a test gi·ªè h√†ng: `tests/working-cart.spec.ts` ch·∫•p nh·∫≠n ti√™u ƒë·ªÅ EN/VI ("Cart" | "Gi·ªè h√†ng").
- S·ª≠a ƒëi·ªÅu h∆∞·ªõng n√∫t Checkout trong sidebar: d√πng `EnhancedButton asChild` b·ªçc `Link` ‚Üí click ƒëi·ªÅu h∆∞·ªõng ch·∫Øc ch·∫Øn t·ªõi `/checkout`.
- Gi·∫£m flakiness Dev SW: ch·ªâ ƒëƒÉng k√Ω `/dev-sw.js` khi c√≥ `VITE_ENABLE_DEV_SW=1`; m·∫∑c ƒë·ªãnh dev kh√¥ng ƒëƒÉng k√Ω SW (Production/PWA v·∫´n gi·ªØ nguy√™n qua `VITE_ENABLE_PWA`/PROD).
- ·ªîn ƒë·ªãnh `checkout.smoke` (Chromium, preview):
  - ƒêi·ªÅu h∆∞·ªõng tr·ª±c ti·∫øp t·ªõi `/checkout` (smoke test) ƒë·ªÉ t·∫≠p trung ki·ªÉm th·ª≠ 3 b∆∞·ªõc form.
  - G·ªçi l·∫°i `disableOverlaysForTest(page)` sau khi v√†o `/checkout` ƒë·ªÉ v√¥ hi·ªáu cookie/consent overlay ch·∫∑n click.

K·∫øt qu·∫£ ki·ªÉm th·ª≠ m·ªõi nh·∫•t (Chromium)
- Unit (Vitest): 79/79 PASS.
- Build + Performance Budget: PASS (`npm run build:check`).
- E2E (Smoke, Preview): `tests/checkout.smoke.spec.ts` PASS.
- E2E (Dev, sau khi t·∫Øt dev SW m·∫∑c ƒë·ªãnh):
  - `tests/visual-search.spec.ts` PASS
  - `tests/performance-virtual-scroll.spec.ts` PASS
- E2E (Preview, ch·∫°y chung m·ªôt phi√™n):
  - `tests/compare.spec.ts`, `tests/lens-zoom.spec.ts`, `tests/trending-searches.spec.ts` ‚Üí PASS
- E2E (Preview, ri√™ng l·∫ª):
  - `tests/recommendations.spec.ts` ‚Üí PASS

H∆∞·ªõng d·∫´n ch·∫°y nhanh
- C√†i Playwright browsers (l·∫ßn ƒë·∫ßu): `npx playwright install chromium`
- Smoke (preview + build): `npm run test:e2e:preview -- --project=chromium tests/checkout.smoke.spec.ts`
- Nh√≥m E2E preview ·ªïn ƒë·ªãnh: `npx playwright test -c playwright.preview.config.ts --project=chromium --reporter=line tests/compare.spec.ts tests/lens-zoom.spec.ts tests/trending-searches.spec.ts`
- Nh√≥m E2E dev (khi dev SW t·∫Øt m·∫∑c ƒë·ªãnh): `npx playwright test -c playwright.config.ts --project=chromium --reporter=line tests/visual-search.spec.ts tests/performance-virtual-scroll.spec.ts`

T·ªïng k·∫øt
- App ƒë√£ s·∫µn s√†ng ki·ªÉm th·ª≠ v√† build production ·ªïn ƒë·ªãnh.
- Smoke flow Checkout PASS; c√°c t√≠nh nƒÉng tr·ªçng y·∫øu (so s√°nh, g·ª£i √Ω s·∫£n ph·∫©m, lens zoom, trending/visual search, virtual-scroll) ƒë·ªÅu PASS ·ªü Chromium.
- Dev m√¥i tr∆∞·ªùng √≠t flakiness h∆°n nh·ªù b·ªè ƒëƒÉng k√Ω SW m·∫∑c ƒë·ªãnh; v·∫´n c√≥ th·ªÉ b·∫≠t l·∫°i khi c·∫ßn (`VITE_ENABLE_DEV_SW=1`).
